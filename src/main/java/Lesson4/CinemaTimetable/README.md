# Подготовка к собеседованию Java-разработчика

<details>
<summary>Урок 4. Базы данных</summary>

Задача про кинотеатр.  
У фильма, который идет в кинотеатре, есть название, длительность (пусть будет 60, 90 или 120 минут), цена билета (в разное время и дни может быть разной), время начала сеанса (один фильм может быть показан несколько раз в разное время и с разной ценой билета). Есть информация о купленных билетах (номер билета, на какой сеанс).  

**Задания:**
* Составить грамотную нормализованную схему хранения этих данных в БД. Внести в нее 4–5 фильмов, расписание на один день и несколько проданных билетов.  
* Сделать запросы, считающие и выводящие в понятном виде:  
  - ошибки в расписании (фильмы накладываются друг на друга), отсортированные по возрастанию времени. Выводить надо колонки «фильм 1», «время начала», «длительность», «фильм 2», «время начала», «длительность»;  
  - перерывы 30 минут и более между фильмами — выводить по уменьшению длительности перерыва. Колонки «фильм 1», «время начала», «длительность», «время начала второго фильма», «длительность перерыва»;
  - список фильмов, для каждого — с указанием общего числа посетителей за все время, среднего числа зрителей за сеанс и общей суммы сборов по каждому фильму (отсортировать по убыванию прибыли). Внизу таблицы должна быть строчка «итого», содержащая данные по всем фильмам сразу;
  - число посетителей и кассовые сборы, сгруппированные по времени начала фильма: с 9 до 15, с 15 до 18, с 18 до 21, с 21 до 00:00 (сколько посетителей пришло с 9 до 15 часов и т.д.).

**Решение (CinemaTimetable):**  
SQL-скпипт (MySQL) + модель в jpg-файле (связи, индексы, внешние ключи).  
Схема: cinema. Таблицы: movies, halls, seats, sessions, prices, tickets. Данные предзаполнены для решения задания.
Запрос для вывода накладывающихся друг на друга фильмов сделал в двух вариантах:
1) вывод "в лоб" (расчет времени окончания каждого сеанса, inner join, выборка тех вариантов, в которых начало сеанса попадает в диапазон между началом и окончанием другого сеанса, наложения сеансов на самих себя исключены по условию);
2) объединенное решение накладок в сеансах и длительные перерывы (расчет даты-времени начала и окончания сеансов, сведение данных о сеансах и фильмах, выборка по условию (только в 1 зале),  сортировка по времени начала (для последующего использования в функции LEAD), добавление поля с началом следующего сеанса (с помощью оконной функции LEAD), продолжительность перерыва в минутах и описание ошибки ("наложение сеансов", "нет перерыва" или "долгий перерыв").


3) Статистика по каждому фильму и итог – через UNION;
4) Группировка числа посетителей и кассовые сборы по каждому фильму – через поля с CASE WHEN...  
   
Результаты запросов приведены после каждого запроса и закомментированы.
</details>
